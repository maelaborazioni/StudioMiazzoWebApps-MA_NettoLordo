/**
 * @type {Number}
 * 
 * @properties={typeid:35,uuid:"22394468-A0A8-4325-AADC-A367842C7316",variableType:8}
 */
var vInqAliquotaINAIL = null;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"325CA3B4-6FC3-4624-A8C3-4D675DF81EBD",variableType:4}
 */
var vInqScontoINAIL = 0;

/**
 * @type {Number}
 * 
 * @properties={typeid:35,uuid:"3189A0C6-5131-4735-860D-F722BD495AB4",variableType:8}
 */
var vInqAnnoFiscale = globals.TODAY.getFullYear();

/**
 * @type {String}
 *  
 * @properties={typeid:35,uuid:"380D8D09-0D60-4D7A-9AC4-E730AD6C972B"}
 */
var vInqCCNL = null;

/**
 * @type {String}
 * 
 * @properties={typeid:35,uuid:"273AE284-945C-4C6A-9D68-5401113081C1"}
 */
var vInqCodQualifica = null;

/**
 * @type {Number}
 * 
 * @properties={typeid:35,uuid:"42E11847-F198-43FC-8449-B20F60B734CF",variableType:8}
 */
var vInqCodSettoreAppartenenza = null;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"9D360E2A-C2B7-473C-9DEA-CB4E07234793",variableType:4}
 */
var vInqCostoOrario = 2;

/**
 * @type {String}
 * 
 * @properties={typeid:35,uuid:"F20389B9-95A4-47AC-BCC8-375C66461C02"}
 */
var vInqDescrAgg = "";

/**
 * @type {String}
 * 
 * @properties={typeid:35,uuid:"170E91CA-ECA0-488E-805B-B97033A0712C"}
 */
var vInqDimAziendale = null;

/**
 * @type {Number}
 * 
 * @properties={typeid:35,uuid:"F1A49DAA-1E5D-43DD-BCB3-97A342421FCF",variableType:8}
 */
var vInqDivisoreCCNL = null;

/**
 * @type {Number}
 * 
 * @properties={typeid:35,uuid:"BF397CCC-2AAC-4391-BBC0-B08C02F438C7",variableType:8}
 */
var vInqIdCCNL = null;

/**
 * @type {Number}
 * 
 * @properties={typeid:35,uuid:"F533808A-9EB1-417A-977E-DDE73AF06C66",variableType:8}
 */
var vInqIdQualifica = null;

/**
 * @type {Number}
 * 
 * @properties={typeid:35,uuid:"F885F8A3-4417-461F-8BEA-2BC0DAAA22CE",variableType:8}
 */
var vInqIdSettoreAppartenenza = null;

/**
 * @type {Number}
 * 
 * @properties={typeid:35,uuid:"32F4BA82-0817-4E18-9F29-D1C95E72B7C0",variableType:8}
 */
var vInqIdTabContributi = null;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"6A8CA7D0-15B1-4267-AC92-AC993C3A8F76",variableType:4}
 */
var vInqLavoroSomministrato = 2;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"B149146C-9851-471B-A625-B61220FFDE3E",variableType:4}
 */
var vInqSgravioJobAct = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"68B7A07A-9AC7-44CB-8FC6-E2E03B09111C",variableType:4}
 */
var vInqMensilita = 13;

/**
 * @type {String}
 * 
 * @properties={typeid:35,uuid:"2A0B84FF-C2BD-4C67-96C5-4BED085EF8B6"}
 */
var vInqNominativo = "";

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"8BAA04FA-E549-4D0E-8762-40500A12CD30",variableType:4}
 */
var vInqOrarioDiLavoro = 1;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"9BDBCAB3-2131-4345-B302-EF0991C726B3",variableType:8}
 */
var vInqOreFerie = 0.00;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"C5A8A473-4F51-4F30-B87E-951AFE027324",variableType:8}
 */
var vInqOrePartTime = null;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"5D086BA7-C192-47E5-9C12-24BBA8AC538B",variableType:8}
 */
var vInqOreRol = 0.00;

/**
 * @type {Number}
 * 
 * @properties={typeid:35,uuid:"D697EE48-0B0C-4FAE-B774-CDDA2588B359",variableType:8}
 */
var vInqOreSettimanali = null;

/**
 * @type {String}
 * 
 * @properties={typeid:35,uuid:"1D34CE71-E3FA-42C9-B501-EC71476414EE"}
 */
var vInqQualifica = null;

/**
 * @type {String}
 * 
 * @properties={typeid:35,uuid:"32FB7A73-5DFA-4998-8014-FBC94F10A2C2"}
 */
var vInqSettoreAppartenenza = null;

/**
 * @type {Number}
 *  
 * @properties={typeid:35,uuid:"3621B329-2211-4ACF-9A74-45BC6E3B6239",variableType:8}
 */
var vInqSituazioneLavorativa = null;

/**
 * @type {String}
 * 
 * @properties={typeid:35,uuid:"866EB287-0A75-43A4-AD69-5F91E061D9E6"}
 */
var vInqSituazioneLavorativaDescr = null;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"67AEFB96-8C38-4A4B-B359-E481B5C200BC",variableType:4}
 */
var vInqTipoCalcoloFerie = 1;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"B689AD8A-60E2-4F52-B6B4-34D187A88CB0",variableType:4}
 */
var vInqTipologiaCalcolo = 1;

/**
 * @type {Number}
 * 
 * @properties={typeid:35,uuid:"1DB6B522-A8E8-4DBD-B30E-AA14DAC0991D",variableType:8}
 */
var vInqTipologiaRapporto = 1;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"7C749E76-DAFC-4A7C-8FFC-06C7083715D3",variableType:4}
 */
var vSegnoOreFerie = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"03A1D3D0-550F-4998-B230-89B11AF309D6",variableType:4}
 */
var vSegnoOreROL = 0;

/**
 * @param {JSRecord<db:/ma_presenze/e2tabgruppicontrattuali>} rec
 *
 * @properties={typeid:24,uuid:"43453A2A-160D-47DC-A189-87DDD845CBBC"}
 */
function updateCCNL(rec)
{
	vInqIdCCNL = rec.idgruppocontrattuale;
	vInqCCNL = rec.descrizione;
	vInqDivisoreCCNL = rec.divisorecontrattuale;
	vInqOreSettimanali = rec.orariosettimanale;
	
	globals.calcolaImponibile();
	globals.aggiornaImponibileTabella();
	globals.verificaDatiInseriti();
}

/**
 * Aggiorna le informazioni in seguito alla scelta del settore di appartenenza
 * 
 * @param {JSRecord<db:/ma_nl/e2nlsettoriappartenenza>} _rec
 *
 * @properties={typeid:24,uuid:"70D94DD7-4032-401D-BFEF-743E228D482A"}
 */
function updateSettore(_rec)
{
	var vOldIdSettoreAppartenenza = vInqIdSettoreAppartenenza;
	
	vInqIdSettoreAppartenenza = _rec.idsettore;
	vInqCodSettoreAppartenenza = _rec.codice;
	vInqSettoreAppartenenza = _rec.settore;
	
	vInqIdQualifica = null;
	vInqCodQualifica = '';
	vInqQualifica = null;
	vInqDimAziendale = null;
	vInqIdTabContributi = null;
	
	elements.btn_lkp_qualifica.enabled = true;
	elements.btn_lkp_dimaziendale.enabled = false;
	
	if(vOldIdSettoreAppartenenza != vInqIdSettoreAppartenenza)
	{
		//nel caso di un collaboratore
	    if(vInqIdSettoreAppartenenza == 9)
	       aggiornaSelezioneCollaboratore(true);
	    else
	       aggiornaSelezioneCollaboratore(false);
	}
	
	globals.calcolaImponibile();
	globals.pulisciContributi();
	globals.verificaDatiInseriti();
}

/**
 * @param {JSFoundset<db:/ma_nl/e2nlsettoriappartenenza>} fs
 *
 * @properties={typeid:24,uuid:"AD08A435-7CEB-4252-B5EC-780BCD7613B0"}
 */
function filterSettore(fs)
{
	//TODO verifica anno fiscale per aggiornamento detrazioni 2015
//	if(vInqAnnoFiscale == 2015)
//	{
//		var answer = globals.ma_utl_showYesNoQuestion("<html>Lo sviluppo del netto e la determinazione del costo sono determinati con le aliquote <br/>contributive e fiscali vigenti al 31 Dicembre 2014. Procedere?</html>","Variazioni anno fiscale");
//	    if(!answer)
//	    	return null;
//	    else
//	    	vInqAnnoFiscale = 2014;
//	}	
		
	var sqlSet = "SELECT idSettore FROM E2TabContributi WHERE ValidoDal = ? GROUP BY idSettore";
    var arrSet = [vInqAnnoFiscale * 100 + 1];
    var dsSet = databaseManager.getDataSetByQuery(globals.Server.MA_NL,sqlSet,arrSet,-1);
    fs.addFoundSetFilterParam('mostrainnettolordo','=',1);
    fs.addFoundSetFilterParam('idsettore','IN',dsSet.getColumnAsArray(1));
	
	return fs;
}

/**
 * @param {JSRecord<db:/ma_nl/e2tabqualificheinps>} rec
 *
 * @properties={typeid:24,uuid:"B50E8446-BC5D-49FB-847A-38C3CA0A2593"}
 */
function updateQualifiche(rec)
{
	vInqIdQualifica = rec.idqualificheinps;
	vInqCodQualifica = rec.cud_qualifica_assic;
	vInqQualifica = rec.descrizione;
	
	vInqDimAziendale = null;
	vInqIdTabContributi = null;
		
	if(!rec.ammetteinail)
	{
		vInqAliquotaINAIL = 0;
		elements.fld_aliqInail.visible = false;
		elements.lbl_aliqInail.visible = false;
	}
	else
	{
		elements.fld_aliqInail.visible = true;
		elements.lbl_aliqInail.visible = true;
	}
	
	elements.btn_lkp_dimaziendale.enabled = true;
	
	// disabilitazione sgravio jobs act nel caso di apprendisti
	if(vInqCodQualifica == 5)
		vInqSgravioJobAct = 0;
	elements.fld_job_act.visible = elements.lbl_job_act.visible = (vInqCodQualifica != 5);
		
	
	globals.calcolaImponibile();
	globals.pulisciContributi();
	globals.verificaDatiInseriti();
}

/**
 * @param {JSFoundset<db:/ma_nl/e2tabqualificheinps>} fs
 *
 * @properties={typeid:24,uuid:"D5478A6D-88D3-4D4B-8AE9-91D519DF3798"}
 */
function filterQualifiche(fs)
{
	fs.addFoundSetFilterParam('mostrainmanettolordo','=', 1);
	//a seconda della selezione precedente del codice del settore di appartenenza
	switch(vInqCodSettoreAppartenenza)
	{	
		// gestione settore COLLABORATORI
		case 0:
			fs.addFoundSetFilterParam('solopercodicesettore','=', '0');
			break;
	    // gestione settore COOPERATIVE    
		case 11:
			fs.addFoundSetFilterParam('solopercodicesettore','=',null);
	        fs.addFoundSetFilterParam('idqualificheinps','IN',[45,46]);
			break;
		// gestione altri settori	
		default:
		    fs.addFoundSetFilterParam('solopercodicesettore','=',null);
		    fs.addFoundSetFilterParam('idqualificheinps','NOT IN',[45,46]);
		    break;
	}	
	var sqlSet = "SELECT qualifiche FROM E2TabContributi WHERE ValidoDal = ? GROUP BY qualifiche";
	var arrSet = [vInqAnnoFiscale * 100 + 1];
	var dsSet = databaseManager.getDataSetByQuery(globals.Server.MA_NL,sqlSet,arrSet,-1);
	fs.addFoundSetFilterParam('cud_qualifica_assic','IN',dsSet.getColumnAsArray(1));	
		
	return fs;
}

/**
 * @param {JSFoundset<db:/ma_nl/e2tabcontributi>} fs
 *
 * @properties={typeid:24,uuid:"712A73CB-B42F-42B4-B59E-4C6DFAB1FF41"}
 */
function filterDimAziendale(fs)
{
	var sqlDim = "SELECT idTabContributi FROM [MA_Presenze].[dbo].[F_NL_NumeroDipendentiCTR](" + vInqIdSettoreAppartenenza + 
	             ",'" + vInqCodQualifica + "'," + vInqAnnoFiscale + ")";
    var dsDim = databaseManager.getDataSetByQuery(globals.Server.MA_NL,sqlDim,null,-1);
    
    fs.addFoundSetFilterParam('idtabcontributi','IN',dsDim.getColumnAsArray(1));
        
    return fs;
}

/**
 * @param {JSRecord<db:/ma_nl/e2tabcontributi>} rec
 *
 * @properties={typeid:24,uuid:"22B767CD-4865-4388-BEEA-D7C50E0FAAC1"}
 */
function updateDimAziendale(rec)
{
	vInqDimAziendale = rec.descrizione;
	vInqIdTabContributi = rec.idtabcontributi;
    
	globals.calcolaImponibile();
//	globals.aggiornaImponibileTabella();
	globals.pulisciContributi();
	globals.verificaDatiInseriti();
}

/** *
 * @param _firstShow
 * @param _event
 *
 * @properties={typeid:24,uuid:"6ACA219E-464D-43CF-B470-B25072F1BD81"}
 * @SuppressWarnings(unused)
 */
function onShowForm(_firstShow, _event) 
{
	_super.onShowForm(_firstShow, _event);
	
	// imposta valori iniziali solo la prima volta	che viene visualizzata
	if(_firstShow)
	{
		vInqAnnoFiscale = 2016; //TODO rimettere dopo il caricamento delle nuove aliquote - globals.TODAY.getFullYear();
		elements.btn_lkp_qualifica.enabled = false;
		elements.btn_lkp_dimaziendale.enabled = false;
		
		// prepara la gestione delle voci di costo orario
		var frm = forms.NL_costoorario_tbl;
		var frmName = frm.controller.getName() + '_temp';
		
		elements.tab_costo_orario.removeAllTabs();
		
		if(solutionModel.getForm(frmName) != null)
		{
			history.removeForm(frmName);
			solutionModel.removeForm(frmName);
		}
		
		var frmTemp = solutionModel.cloneForm(frmName,solutionModel.getForm(frm.controller.getName()));
		
		var dsVociCosto = databaseManager.createEmptyDataSet(0,0);
		dsVociCosto.addColumn('descrizione',1,JSColumn.TEXT);
		dsVociCosto.addColumn('percentuale',2,JSColumn.NUMBER);
		
		var dSVociCosto = dsVociCosto.createDataSource('dSVociCosto');
		
		solutionModel.getForm(frmName).dataSource = dSVociCosto;
		solutionModel.getForm(frmName).getField('fld_descrizione').dataProviderID = dsVociCosto.getColumnName(1);
		solutionModel.getForm(frmName).getField('fld_maggiorazione').dataProviderID = dsVociCosto.getColumnName(2);
	
	    elements.tab_costo_orario.addTab(frmName);
	}
		
	globals.ma_utl_setStatus(globals.Status.EDIT,controller.getName());
}

/**
 * Handle changed data.
 *
 * @param oldValue old value
 * @param newValue new value
 * @param {JSEvent} event the event that triggered the action
 *
 * @returns {Boolean}
 *
 * @private
 *
 * @properties={typeid:24,uuid:"D377E83A-1F0C-4BCE-BDE8-AC10ACF185A3"}
 */
function onDataChangeCalcoloFerieRol(oldValue, newValue, event) {
	
//	if(newValue == 2)
//    {
//    	elements.lbl_oreFerie.visible = 
//    	elements.lbl_oreROL.visible =
//        elements.cmb_oreFerie.visible = 
//    	elements.fld_oreFerie.visible = 
//    	elements.fld_oreROL.visible = 
//    	elements.cmb_oreROL.visible = true;
//    }
//    else
//    {
//    	vInqOreFerie = vInqOreRol = null;
//    	elements.lbl_oreFerie.visible = 
//    	elements.cmb_oreFerie.visible =	
//    	elements.lbl_oreROL.visible =
//    	elements.fld_oreFerie.visible = 
//    	elements.fld_oreROL.visible = 
//    	elements.cmb_oreFerie.visible = false;
//    }
    
    globals.calcolaImponibile();
    globals.aggiornaImponibileTabella();
    globals.verificaDatiInseriti();
	return true;
}

/**
 * Handle changed data.
 *
 * @param oldValue old value
 * @param newValue new value
 * @param {JSEvent} event the event that triggered the action
 *
 * @returns {Boolean}
 *
 * @private
 *
 * @properties={typeid:24,uuid:"33280CBD-88EC-4DB9-87B3-616CD4DF4898"}
 */
function onDataChangeTipoOrarioLavoro(oldValue, newValue, event) 
{
	if(newValue == 2)
	{
		elements.lbl_orePartTime.visible = 
			elements.fld_orePartTime.visible = true;
	}
	else
	{
		vInqOrePartTime = null;
		elements.lbl_orePartTime.visible = 
	        elements.fld_orePartTime.visible = false;
	}
	
	globals.verificaDatiInseriti();
	
	return true;
}

/**
 * Handle changed data.
 *
 * @param oldValue old value
 * @param newValue new value
 * @param {JSEvent} event the event that triggered the action
 *
 * @returns {Boolean}
 *
 * @private
 *
 * @properties={typeid:24,uuid:"B62F648D-8E20-41BC-9CCE-44727C81AF00"}
 */
function onDataChangeSituazioneLavorativa(oldValue, newValue, event) {
	
	globals.calcolaImponibile();
	globals.aggiornaImponibileTabella();
	globals.verificaDatiInseriti();
	return true;
}

/**
 * Handle changed data.
 *
 * @param oldValue old value
 * @param newValue new value
 * @param {JSEvent} event the event that triggered the action
 *
 * @returns {Boolean}
 *
 * @private
 *
 * @properties={typeid:24,uuid:"0FAA1023-1595-4E65-874A-94F70D972020"}
 */
function onDataChangeAliquotaInail(oldValue, newValue, event) {
	
	globals.calcolaImponibile();
	globals.aggiornaImponibileTabella();
	globals.verificaDatiInseriti();
	return true;
}

/**
 * Handle changed data.
 *
 * @param oldValue old value
 * @param newValue new value
 * @param {JSEvent} event the event that triggered the action
 *
 * @returns {Boolean}
 *
 * @private
 *
 * @properties={typeid:24,uuid:"7EFB81EF-21B1-47AD-8537-5F709DFF0DDC"}
 */
function onDataChangeTipologiaRapprto(oldValue, newValue, event) {
	
	globals.calcolaImponibile();
	globals.aggiornaImponibileTabella();
	globals.verificaDatiInseriti();
	return true;
}

/**
 * Handle changed data.
 *
 * @param oldValue old value
 * @param newValue new value
 * @param {JSEvent} event the event that triggered the action
 *
 * @returns {Boolean}
 *
 * @private
 *
 * @properties={typeid:24,uuid:"3C7E2B1A-8887-4399-9DC6-26D7BC1ADA1F"}
 */
function onDataChangeDivisoreCCNL(oldValue, newValue, event) {
	
	globals.calcolaImponibile();
	globals.aggiornaImponibileTabella();
	globals.verificaDatiInseriti();
	return true
}

/**
 * Handle changed data.
 *
 * @param oldValue old value
 * @param newValue new value
 * @param {JSEvent} event the event that triggered the action
 *
 * @returns {Boolean}
 *
 * @private
 *
 * @properties={typeid:24,uuid:"F2B1C4D2-83C4-42F1-8DCD-E50C0BD7F049"}
 */
function onDataChangeOreSettimanali(oldValue, newValue, event) {
	
	globals.calcolaImponibile();
	globals.aggiornaImponibileTabella();
	globals.verificaDatiInseriti();
	return true
}

/**
 * Handle changed data.
 *
 * @param oldValue old value
 * @param newValue new value
 * @param {JSEvent} event the event that triggered the action
 *
 * @returns {Boolean}
 *
 * @private
 *
 * @properties={typeid:24,uuid:"0A4CFEF5-1136-43DA-9B30-6621A3FAA8A5"}
 */
function onDataChangeMensilita(oldValue, newValue, event) {
	
	globals.calcolaImponibile();
	globals.aggiornaImponibileTabella();
	globals.verificaDatiInseriti();
	return true
}

/**
 * Handle changed data.
 *
 * @param oldValue old value
 * @param newValue new value
 * @param {JSEvent} event the event that triggered the action
 *
 * @returns {Boolean}
 *
 * @private
 *
 * @properties={typeid:24,uuid:"8BEA560C-851E-44A2-B489-AF0CF50A45C5"}
 */
function onDataChangeOrePartTime(oldValue, newValue, event) {
	
	if(newValue > vInqOreSettimanali)
	{
		forms.NL_main.setStatusWarning('Il numero di ore settimanali part-time dev\'essere minore del numero di ore settimanali totali',null,500);
	    return false;
	}
	
	globals.calcolaImponibile();
	globals.aggiornaImponibileTabella();
	globals.verificaDatiInseriti();
	return true;
}

/**
 * Handle changed data.
 *
 * @param oldValue old value
 * @param newValue new value
 * @param {JSEvent} event the event that triggered the action
 *
 * @returns {Boolean}
 *
 * @private
 *
 * @properties={typeid:24,uuid:"F6F921C4-CA14-4AFE-961B-559734214B2D"}
 */
function onDataChangeOreFerie(oldValue, newValue, event) {
	
	globals.calcolaImponibile();
	globals.aggiornaImponibileTabella();
	globals.verificaDatiInseriti();
	return true;
}

/**
 * Handle changed data.
 *
 * @param oldValue old value
 * @param newValue new value
 * @param {JSEvent} event the event that triggered the action
 *
 * @returns {Boolean}
 *
 * @private
 *
 * @properties={typeid:24,uuid:"40BF259C-AB1F-451F-9D49-5702118D8709"}
 */
function onDataChangeOreRol(oldValue, newValue, event) {
	globals.calcolaImponibile();
	globals.verificaDatiInseriti();
	return true;
}

/**
 * @param {Boolean} isCollab
 * 
 * @properties={typeid:24,uuid:"B10BC5FE-0741-43D9-8DEA-AFCF43059C7A"}
 */
function aggiornaSelezioneCollaboratore(isCollab)
{
	var abilita = true;
	
	if(isCollab)
	{
		abilita = false;
		vInqCostoOrario = 2;
	}
	//possibilità di selezionarie ferie godute/ non godute
	vInqTipoCalcoloFerie = 1;
    elements.lbl_tipocalcoloferierol.visible = 
    elements.cmb_tipocalcoloferierol.visible = abilita;
    
    //situazione lavorativa normale
    vInqSituazioneLavorativa = 1;
    elements.lbl_situazLavorativa.visible = 
    elements.cmb_situazLavorativa.visible = abilita;
    
    //lavoro somministrato
    vInqLavoroSomministrato = 2;
    elements.lbl_lavorosomm.visible =
    elements.cmb_lavorosomm.visible = abilita;	
    
    //mensilità riporta a 12
    vInqMensilita = 12;
    elements.lbl_mensilita.visible = 
    elements.cmb_mensilita.visible = abilita;
    
    //divisore ccnl e ore settimanali non previste
    if(!abilita)
    {
    	vInqDivisoreCCNL = 1;
        vInqOreSettimanali = 1;
    }
    else
    {
    	vInqDivisoreCCNL = null;
    	vInqOreSettimanali = null;
    }
    elements.lbl_div_ccnl.visible = 
    elements.fld_div_ccnl.visible = abilita;
    elements.lbl_oresettimana.visible = 
    elements.fld_oresettimana.visible = abilita;
    
    // orario di lavoro sempre full time
    vInqOrarioDiLavoro = 1;
	elements.lbl_orarioLavoro.visible = 
	elements.cmb_orarioLavoro.visible = abilita;
	elements.lbl_orePartTime.visible = 
		elements.fld_orePartTime.visible = false;
	
	elements.lbl_oresettimana.visible =
	elements.fld_oresettimana.visible = abilita;
		
	//ore ferie/rol e rispettivi segni
	vInqOreFerie = vInqOreRol = 0.00;
	vSegnoOreFerie = vSegnoOreROL = 1;
	elements.lbl_oreFerie.visible = 
	elements.fld_oreFerie.visible = abilita;
	elements.lbl_oreROL.visible = 
	elements.fld_oreROL.visible = abilita;
	elements.lbl_segnoOreFerie.visible = 
	elements.lbl_segnoOreROL.visible = 
	elements.cmb_oreFerie.visible = 
	elements.cmb_oreROL.visible = abilita;
	
	
	//disattivare flag su retribuzione
	var frm = forms.NL_tab_retrib_contr;
	frm.vRetCtrFt = frm.vRetCtrPc = frm.vRetMaggiorazione = 0;
	frm.elements.lbl_maggiorazionectr.visible = 
	frm.elements.lbl_recuperoctrft.visible = 
	frm.elements.lbl_recuperoctrpc.visible = 
	frm.elements.chk_maggiorazionectr.visible = 
	frm.elements.chk_recuperoctrft.visible = 
	frm.elements.chk_recuperoctrpc.visible = abilita;
			
}

/**
 * Handle changed data.
 *
 * @param oldValue old value
 * @param newValue new value
 * @param {JSEvent} event the event that triggered the action
 *
 * @returns {Boolean}
 *
 * @private
 *
 * @properties={typeid:24,uuid:"E9667EFE-6879-4EB2-B493-492561FF4D44"}
 */
function onDataChangeAnnoFiscale(oldValue, newValue, event) {
	
	vInqIdSettoreAppartenenza = null;
	vInqCodSettoreAppartenenza = null;
	vInqSettoreAppartenenza = '';
	vInqIdQualifica = null;
	vInqCodQualifica = '';
	vInqQualifica = null;
	vInqDimAziendale = null;
	vInqIdTabContributi = null;
	
	elements.btn_lkp_qualifica.enabled = false;
	elements.btn_lkp_dimaziendale.enabled = false;
	
	if(newValue < 2015)
	{
		elements.lbl_job_act.enabled =
		  elements.fld_job_act.enabled = false;
//	    elements.fld_job_act.toolTipText = 'Calcolo da lordo a netto in corso di verifica!';
		vInqSgravioJobAct = 0;
	}
	else
	{
	   elements.lbl_job_act.enabled = 
		 elements.fld_job_act.enabled = true;
//	   elements.fld_job_act.toolTipText = ''; 	 
	}
	
	globals.pulisciContributi();
	
	globals.verificaDatiInseriti();
	
	return true;
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @private
 *
 * @properties={typeid:24,uuid:"5CA2DE0D-2197-458D-A4BF-EDEAB8C786E4"}
 */
function aggiungiVoce(event) {
	
	var frm = forms.NL_costoorario_dtl;
	frm.vIsInEdit = false;
	frm.inizializzaVariabiliVoceCosto(null,null);
	globals.ma_utl_showFormInDialog(frm.controller.getName(),'Aggiungi una voce per il costo orario');
	
}

/**
 * @param {JSEvent} event
 *
 * @properties={typeid:24,uuid:"C4492585-E3A1-43A3-A991-6825DEEB6B36"}
 */
function modificaVoce(event)
{
	var frmTbl = forms['NL_costoorario_tbl_temp'];
	if(frmTbl.foundset.getSize() > 0)
	{
		var frmDtl = forms.NL_costoorario_dtl;
		frmDtl.vIsInEdit = true;
		frmDtl.inizializzaVariabiliVoceCosto(frmTbl.foundset['descrizione']
		                                    ,frmTbl.foundset['percentuale']);
		globals.ma_utl_showFormInDialog(frmDtl.controller.getName(),'Modifica una voce del costo orario');
	}
	else
		forms.NL_main.setStatusWarning('Non esistono voci di costo orario da modificare',null,500);
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @private
 *
 * @properties={typeid:24,uuid:"56B1D029-D6CE-474F-8DEA-35BDC830A374"}
 */
function eliminaVoce(event)
{
	var frm = forms['NL_costoorario_tbl_temp'];
	if (frm && frm.foundset && frm.foundset.getSize() > 0) 
	{
		var success = frm.foundset.deleteRecord();
		if (!success)
			forms.NL_main.setStatusWarning('Voce costo orario non eliminata, riprovare',null,500);
		else
			globals.verificaDatiInseriti();
				
	} 
	else
		forms.NL_main.setStatusWarning('Non esistono voci costo orario da eliminare',null,500);
}

/**
 * @return {Array}
 * 
 * @properties={typeid:24,uuid:"6E4B5E7C-397D-4D9C-A0A4-6C2936431204"}
 */
function getVociCostoOrario()
{
	var frmName = elements.tab_costo_orario.getTabFormNameAt(1);
	var frm = forms[frmName];
	var arrVociCO = [];
	
	if (frm && frm.foundset) {
		for (var i = 1; i <= frm.foundset.getSize(); i++) {
			var vociCORiga = new Object();
			frm.foundset.alldataproviders.forEach(function(dp) {
				vociCORiga[dp] = frm.foundset.getRecord(i)[dp]
			})

			arrVociCO.push(vociCORiga);
		}
	}
	
	return arrVociCO;
}

/**
 * Handle changed data.
 *
 * @param oldValue old value
 * @param newValue new value
 * @param {JSEvent} event the event that triggered the action
 *
 * @returns {Boolean}
 *
 * @properties={typeid:24,uuid:"BFFED0F7-0AE5-48EA-9AF7-E3AEB12DA706"}
 */
function onDataChangeCalcoloCO(oldValue, newValue, event) {
	
	var abilita = true;
	
	if(newValue == 1)
	   abilita = true;
	else
       abilita = false;
       
	elements.lbl_titlebar_co.visible =
	elements.lbl_co.visible = abilita;
	elements.btn_nuova_voce.visible =
	elements.btn_modifica_voce.visible =
	elements.btn_cancella_voce.visible = abilita;
	elements.tab_costo_orario.visible = abilita;
	
	if(!abilita)
	{
		// cancella le voci esistenti
		var frm = forms['NL_costoorario_tbl_temp'];
		
		if (frm && frm.foundset && frm.foundset.getSize() > 0) 
		{
			var fSize = frm.foundset.getSize();
			
			for(var i=1; i<= fSize; i++)
			{
			   var success = frm.foundset.deleteRecord();
			   if(!success)
			     forms.NL_main.setStatusWarning('Aggiornamento visualizzazione : voce costo orario non eliminata, riprovare',null,500);
			} 
		    
		    globals.verificaDatiInseriti();
	    }
	}	
	
	return true;
}

/**
 * @properties={typeid:24,uuid:"DBF5093F-9DE5-407B-8EC7-89433058DBB3"}
 */
function getDescrizioneSituazioneLavorativa()
{
	switch (vInqSituazioneLavorativa)
	{
		case 1:
			return 'Normale';
			break;
		case 2:
			return 'Mobilità';
			break;
		case 3:
			return 'Disoccupazione/Cig';
			break;
		default:
			return null;
			break;
	}
	
	
}

/**
 * Handle changed data.
 *
 * @param oldValue old value
 * @param newValue new value
 * @param {JSEvent} event the event that triggered the action
 *
 * @returns {Boolean}
 *
 * @private
 *
 * @properties={typeid:24,uuid:"50A39CA9-8849-4641-B429-8D893B264780"}
 */
function onDataChangeTipologiaCalcolo(oldValue, newValue, event) 
{
	if(vInqAnnoFiscale < 2015)
	{
		elements.lbl_job_act.enabled =
		  elements.fld_job_act.enabled = false;
	    vInqSgravioJobAct = 0;
	}
	else
	{
	   elements.lbl_job_act.enabled = 
		 elements.fld_job_act.enabled = true;
	}	
	
	// aggiornamento applicabilità Bonus Renzi
	var frmDetr = forms.NL_tab_ipref_detraz;
	if(newValue == 2)
	   frmDetr.vChkBonusRenzi = 0;		
		
	globals.calcolaImponibile();
    globals.aggiornaImponibileTabella();
    globals.verificaDatiInseriti();
	return true;
	
}

/**
 * Handle changed data.
 *
 * @param oldValue old value
 * @param newValue new value
 * @param {JSEvent} event the event that triggered the action
 *
 * @returns {Boolean}
 *
 * @private
 *
 * @properties={typeid:24,uuid:"E9AD05F2-04B9-4E35-ABB8-6694C3DE11AD"}
 */
function onDataChangeScontoInail(oldValue, newValue, event)
{
	globals.calcolaImponibile();
    globals.aggiornaImponibileTabella();
    globals.verificaDatiInseriti();
    return true;
}

/**
 * @properties={typeid:24,uuid:"28984E61-50E1-4568-BF2C-4F7720C4AD4B"}
 */
function resetValues()
{
	// resetta i valori con quelli di default
	vInqNominativo = "";
	vInqDescrAgg = "";
	vInqAnnoFiscale = globals.TODAY.getFullYear();
	vInqTipologiaCalcolo = 1;
	vInqTipoCalcoloFerie = 1;
	vInqIdCCNL = null;
	vInqCCNL = null;
	vInqDivisoreCCNL = null;
	vInqOreSettimanali = null;
	vInqMensilita = 13;
	vInqIdSettoreAppartenenza = null;
	vInqCodSettoreAppartenenza = null;
	vInqSettoreAppartenenza = null;
	vInqIdTabContributi = null;
	vInqDimAziendale = null;
	vInqAliquotaINAIL = null;
	vInqIdQualifica = null;
	vInqCodQualifica = null;
	vInqQualifica = null;
	vInqSituazioneLavorativa = null;
	vInqSituazioneLavorativaDescr = null;
	vInqTipologiaRapporto = 1; //TODO come inserirla nel report?!?
	vInqOrarioDiLavoro = 1;
	vInqOrePartTime = null;
	vInqOreFerie = null;
	vInqOreRol = null;
	vSegnoOreFerie = 0;
	vSegnoOreROL = 0;
	vInqLavoroSomministrato = 2;
	vInqCostoOrario = 2;
	
	// elimina eventuali voci di maggiorazione presenti
	var frm = forms['NL_costoorario_tbl_temp'];
	var frmSize = frm.foundset.getSize();
	if (frm && frm.foundset && frmSize > 0) 
	{
		for(var i=1; i<= frmSize; i++)
		{
			frm.foundset.deleteRecord();
		}
	}
	
	globals.verificaDatiInseriti();
}

